# Testing search engines

Since srchd is a web scraper by nature, it is a good idea to be able to test search engines quickly and be able to quickly fix things when they break.
As such most engines in srchd have some form of test suite, though generally it just sends off queries and hopes it gets the correct answer back.

The test suite of srchd can be run using `go test .` but the engines test suite can be run with `go test ./search/engines`.

## engtest

srchd contains a small test harness called engtest which will cache all requests and responses sent to a search engine.
The test files are not distributed with srchd because they are big and may contain somewhat personal information, but provided the engines work on your machine running the tests will create ones for you if they aren't there already.

If you would like to update your test files, use `-update`.

### The engtest tool

**You should only need to use this when something is broken.**

To work with data generated by engtest, there's some code that is able to parse engtest's data pull out useful parts about a srchd engine's exchange with a search engine.
This is `./internal/engtest/tool`, and it isn't awesome to work with partially because of how engtest stores its test data, but with it you can pull out the request and response for any given HTTP request made by the engine.

To extract the result HTML from test runs, use `go run ./internal/engtest/tool ./search/engines/testdata/<engine>/<query>/<long string>`.
**This is probably the only one you will need.**
Most problems in srchd are to do with the HTML response of the search engine changing, and just the HTML response alone will usually suffice for fixing the engine.

If you also need the headers, then add the `-headers` flag before the engtest file you want to look at.

In the unlikely event that you need the request, then use the `-req` flag.
Note that this flag implies `-headers` since in nearly every supported engine the HTTP request uses the GET method so no data is ever sent along.
